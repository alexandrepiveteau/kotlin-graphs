name: dokka
on:
  push:
    branches: [ main ]
permissions:
  contents: write

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: 🎁 Checkout repo
        uses: actions/checkout@v3
      - name: 🐘 Setup Gradle
        uses: gradle/gradle-build-action@v2
      - name: 📚 Generate documentation
        run: ./gradlew dokkaHtml
      - name: 📦 Publish documentation
        run: |
          cd build/dokka/html
          git init . && git branch -m dokka
          git add .
          git config user.name "${{github.actor}}"
          git config user.email "${{github.actor}}@users.noreply.github.com"
          git commit -m "🚀 Publish documentation"
          git remote add origin https://${{secrets.GITHUB_TOKEN}}@github.com/${{github.repository}}.git
          git push -u origin dokka --force
